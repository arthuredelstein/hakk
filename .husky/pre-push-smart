echo "ğŸ§ª Running smart pre-push tests..."
echo "================================"

# Get the list of changed files
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts|jsx|tsx)$' || true)

if [ -z "$CHANGED_FILES" ]; then
    echo "â„¹ï¸  No JavaScript/TypeScript files changed. Skipping tests."
    echo "================================"
    exit 0
fi

echo "ğŸ“ Changed files:"
echo "$CHANGED_FILES"
echo ""

# Run linting on changed files
echo "ğŸ” Running linting on changed files..."
echo "$CHANGED_FILES" | xargs npx semistandard

if [ $? -ne 0 ]; then
    echo "âŒ Linting failed! Push aborted."
    echo "ğŸ’¡ Fix the linting errors and try again."
    echo "================================"
    exit 1
fi

# Run all tests (since tests might be affected by any change)
echo "ğŸ§ª Running all tests..."
npm test

if [ $? -eq 0 ]; then
    echo "âœ… All tests passed! Proceeding with push..."
    echo "================================"
    exit 0
else
    echo "âŒ Tests failed! Push aborted."
    echo "ğŸ’¡ Fix the failing tests and try again."
    echo "================================"
    exit 1
fi
